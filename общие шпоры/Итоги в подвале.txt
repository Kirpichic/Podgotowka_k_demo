//Для материалов
&НаКлиенте
Процедура ОтборКатегорияПриИзменении(Элемент)
	Список.Отбор.Элементы.Очистить();
	ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("КатегорияКачества");
	ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение = ОтборКатегория; 
	
	ПолучитьИтог();
КонецПроцедуры

&НаКлиенте
Процедура ПоказатьВсе(Команда)
	Список.Отбор.Элементы.Очистить();
	ОтборКатегория = "";
	
	ПолучитьИтог();
КонецПроцедуры 

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ПолучитьИтог();
КонецПроцедуры


&НаСервере
Процедура ПолучитьИтог()
	Если Не ОтборКатегория.Пустая() Тогда	
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	СУММА(Материалы.Количество) КАК Количество,
			|	КОЛИЧЕСТВО(Материалы.Код) КАК ВсегоМатериалов,
			|	СУММА(Материалы.ЗакупочнаяСтоимость) КАК ЗакупочнаяСтоимость
			|ИЗ
			|	Справочник.Материалы КАК Материалы
			|ГДЕ
			|	Материалы.КатегорияКачества = &КатегорияКачества";	
		Запрос.УстановитьПараметр("КатегорияКачества", ОтборКатегория);	
		РезультатЗапроса = Запрос.Выполнить().Выгрузить();	
		ВсегоМатериалов = РезультатЗапроса[0].ВсегоМатериалов;
		ИтогоЗакупочнаяСтроимость = РезультатЗапроса[0].ЗакупочнаяСтоимость;
		КоличествоМатериалов = РезультатЗапроса[0].Количество;	
	Иначе
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	СУММА(Материалы.Количество) КАК Количество,
			|	КОЛИЧЕСТВО(Материалы.Код) КАК ВсегоМатериалов,
			|	СУММА(Материалы.ЗакупочнаяСтоимость) КАК ЗакупочнаяСтоимость
			|ИЗ
			|	Справочник.Материалы КАК Материалы";		
		РезультатЗапроса = Запрос.Выполнить().Выгрузить();	
		ВсегоМатериалов = РезультатЗапроса[0].ВсегоМатериалов;
		ИтогоЗакупочнаяСтроимость = РезультатЗапроса[0].ЗакупочнаяСтоимость;
		КоличествоМатериалов = РезультатЗапроса[0].Количество;
	КонецЕсли;
КонецПроцедуры


//Для Фурнитуры
&НаКлиенте
Процедура ОтборКатегорияПриИзменении(Элемент)
	Список.Отбор.Элементы.Очистить();
	ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("КатегорияКачества");
	ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение = ОтборКатегория;
	
	ПолучитьИтог()
КонецПроцедуры

&НаКлиенте
Процедура ПоказатьВсе(Команда)
	Список.Отбор.Элементы.Очистить();
	ОтборКатегория = "";
	
	ПолучитьИтог()
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ПолучитьИтог()
КонецПроцедуры

&НаСервере
Процедура ПолучитьИтог()
	Если Не ОтборКатегория.Пустая() Тогда	
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	СУММА(Фурнитура.Количество) КАК Количество,
			|	КОЛИЧЕСТВО(Фурнитура.Код) КАК ВсегоФурнитуры,
			|	СУММА(Фурнитура.ЗакупочнаяСтоимость) КАК ЗакупочнаяСтоимость
			|ИЗ
			|	Справочник.Фурнитура КАК Фурнитура
			|ГДЕ
			|	Фурнитура.КатегорияКачества = &КатегорияКачества";	
		Запрос.УстановитьПараметр("КатегорияКачества", ОтборКатегория);	
		РезультатЗапроса = Запрос.Выполнить().Выгрузить();	
		ВсегоФурнитуры = РезультатЗапроса[0].ВсегоФурнитуры;
		ИтогоЗакупочнаяСтроимость = РезультатЗапроса[0].ЗакупочнаяСтоимость;
		КоличествоФурнитуры = РезультатЗапроса[0].Количество;	
	Иначе  
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	СУММА(Фурнитура.Количество) КАК Количество,
			|	КОЛИЧЕСТВО(Фурнитура.Код) КАК ВсегоФурнитуры,
			|	СУММА(Фурнитура.ЗакупочнаяСтоимость) КАК ЗакупочнаяСтоимость
			|ИЗ
			|	Справочник.Фурнитура КАК Фурнитура";		
		РезультатЗапроса = Запрос.Выполнить().Выгрузить();	
		ВсегоФурнитуры = РезультатЗапроса[0].ВсегоФурнитуры;
		ИтогоЗакупочнаяСтроимость = РезультатЗапроса[0].ЗакупочнаяСтоимость;
		КоличествоФурнитуры = РезультатЗапроса[0].Количество;
	КонецЕсли;
КонецПроцедуры
